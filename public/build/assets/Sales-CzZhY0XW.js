var D=Object.defineProperty;var B=(c,n,i)=>n in c?D(c,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[n]=i;var x=(c,n,i)=>(B(c,typeof n!="symbol"?n+"":n,i),i);import{j as t}from"./AboutHeader-CpM0iYLI.js";import{r as d}from"./index-B80Lgev0.js";import{c as A}from"./ReactAppend-CBRQCQGz.js";import{B as P}from"./Base-CFRwUR9o.js";import{C as O,G as g}from"./CreateReactScript-CyT_ENnh.js";import{T as z}from"./Table-COKXynOQ.js";import{D as w}from"./DxButton-CsjWvhyj.js";import{R as S}from"./ReactAppend-C-tNgxIf.js";import{S as Y}from"./sweetalert2.all-Dh0rZL5X.js";import{B as R}from"./Results-B-D6O2Fz.js";import{N as o}from"./Number2Currency-e57Tgsuk.js";import{M as G}from"./Modal-DUfP1iw0.js";import{i as M}from"./tippy-react.esm-CHhA99mn.js";import{m as C}from"./main-Br9xqDfn.js";import{r as V}from"./DxBox-CdMuSyGE.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-CqDsSnoc.js";/* empty css               */class q extends R{constructor(){super(...arguments);x(this,"path","admin/sales")}}class H extends R{constructor(){super(...arguments);x(this,"path","admin/sale-statuses");x(this,"bySale",async i=>{try{const{status:e,result:l}=await C.Fetch(`/api/${this.path}/by-sale/${i}`);if(!e)throw new Error((l==null?void 0:l.message)||"Ocurrio un error inesperado");return l.data}catch(e){return C.Notify.add({icon:"/assets/img/favicon.png",title:"Error",body:e.message,type:"danger"}),null}})}}const u=new q,I=new H,W=({statuses:c})=>{var f,N,y,v;const n=d.useRef(),i=d.useRef(),[e,l]=d.useState(null),[p,j]=d.useState([]),_=async r=>{const s=await u.save({id:e.id,status_id:r.target.value});s&&(l(s.data),$(n.current).dxDataGrid("instance").refresh())},k=async r=>{const{isConfirmed:s}=await Y.fire({title:"Anular pedido",text:"¿Estas seguro de anular este pedido?",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, anular",cancelButtonText:"Cancelar"});!s||!await u.delete(r)||$(n.current).dxDataGrid("instance").refresh()},b=async r=>{j([]);const s=await u.get(r);l(s.data),$(i.current).modal("show")};d.useEffect(()=>{e&&I.bySale(e.id).then(r=>{j(r||[])})},[e]);const E=Number(e==null?void 0:e.amount)+Number(e==null?void 0:e.delivery)-Number(e==null?void 0:e.coupon_discount);return t.jsxs(t.Fragment,{children:[t.jsx(z,{gridRef:n,title:"Pedidos",rest:u,toolBar:r=>{r.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}})},pageSize:25,columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"code",caption:"Numero de orden",visible:!1},{dataField:"name",caption:"Orden",width:"250px",cellTemplate:(r,{data:s})=>{r.css("cursor","pointer"),r.on("click",()=>{b(s.id)}),S(r,t.jsxs("p",{className:"mb-0",style:{width:"100%"},children:[t.jsxs("b",{className:"d-block",children:[s.renewal&&t.jsx(M,{content:`Plan: ${s.renewal.name}`,children:t.jsx("i",{className:"fa fas fa-spa text-pink me-1"})}),s.name," ",s.lastname]}),t.jsxs("small",{className:"text-nowrap text-muted",style:{overflow:"hidden",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,fontFamily:"monospace"},children:["#",g.APP_CORRELATIVE,"-",s.code]})]}))}},{dataField:"created_at",caption:"Fecha",dataType:"date",sortOrder:"desc",cellTemplate:(r,{data:s})=>{r.html(V(t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"d-block",children:moment(s.created_at.replace("Z","-05:00")).fromNow()}),t.jsx("small",{className:"d-block text-muted",children:moment(s.created_at).format("lll")})]})))}},{dataField:"status.name",caption:"Estado",cellTemplate:(r,{data:s})=>{S(r,t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"badge rounded-pill",style:{backgroundColor:s.status.color?`${s.status.color}2e`:"#3333332e",color:s.status.color??"#333"},children:s.status.name}),t.jsx("small",{className:"d-block text-muted",children:s.status.description})]}))}},{dataField:"amount",caption:"Total",dataType:"number",cellTemplate:(r,{data:s})=>{const a=Number(s.amount)||0,m=Number(s.delivery)||0,h=Number(s.bundle_discount)||0,T=Number(s.renewal_discount)||0,F=Number(s.coupon_discount)||0;r.text(`S/. ${o(a+m-h-T-F)}`)}},{caption:"Acciones",cellTemplate:(r,{data:s})=>{r.append(w({className:"btn btn-xs btn-light",title:"Ver pedido",icon:"fa fa-eye",onClick:()=>b(s.id)})),r.append(w({className:"btn btn-xs btn-soft-danger",title:"Anular pedido",icon:"fa fa-trash",onClick:()=>k(s.id)}))},allowFiltering:!1,allowExporting:!1}]}),t.jsx(G,{modalRef:i,title:`Detalles del pedido #${g.APP_CORRELATIVE}-${e==null?void 0:e.code}`,size:"lg",bodyStyle:{backgroundColor:"#ebeff2"},hideButtonSubmit:!0,children:t.jsxs("div",{className:"row",children:[t.jsxs("div",{className:"col-md-8",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Detalles de Venta"})}),t.jsxs("div",{className:"card-body p-2",children:[t.jsx("table",{id:"table-info",className:"table table-borderless table-sm",children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("th",{children:"Nombres:"}),t.jsxs("td",{children:[e==null?void 0:e.name," ",e==null?void 0:e.lastname]})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"Email:"}),t.jsx("td",{children:e==null?void 0:e.email})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"Teléfono:"}),t.jsx("td",{children:e==null?void 0:e.phone})]}),t.jsxs("tr",{children:[t.jsx("th",{children:"Dirección:"}),t.jsxs("td",{children:[e==null?void 0:e.address," ",e==null?void 0:e.number,t.jsxs("small",{className:"text-muted d-block",children:[(e==null?void 0:e.province)??(e==null?void 0:e.district),", ",e==null?void 0:e.department,","," ",e==null?void 0:e.country," ",(e==null?void 0:e.zip_code)&&t.jsxs(t.Fragment,{children:["-"," ",e==null?void 0:e.zip_code]})]})]})]}),(e==null?void 0:e.reference)&&t.jsxs("tr",{children:[t.jsx("th",{children:"Referencia:"}),t.jsx("td",{children:e==null?void 0:e.reference})]})]})}),t.jsxs("button",{className:"btn btn-xs btn-dark",type:"button",copy:`Nombres: ${e==null?void 0:e.fullname}
Email: ${e==null?void 0:e.email}
Teléfono: ${e==null?void 0:e.phone}
Dirección: ${e==null?void 0:e.address} ${e==null?void 0:e.number}
_${(e==null?void 0:e.province)??(e==null?void 0:e.district)}, ${e==null?void 0:e.department}, ${e==null?void 0:e.country} ${e!=null&&e.zip_code?`- ${e==null?void 0:e.zip_code}`:""}_`,children:[t.jsx("i",{className:"mdi mdi-content-copy me-1"}),"Copiar"]})]})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Artículos"})}),t.jsx("div",{className:"card-body p-2 table-responsive",children:t.jsxs("table",{className:"table table-striped table-bordered table-sm table-hover mb-0",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Nombre"}),t.jsx("th",{children:"Colores"}),t.jsx("th",{children:"Precio"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Subtotal"})]})}),t.jsx("tbody",{children:(f=e==null?void 0:e.details)==null?void 0:f.map((r,s)=>{const a=r.quantity*100/100,m=r.price*r.quantity;return t.jsxs("tr",{children:[t.jsx("td",{children:r.name}),t.jsx("td",{children:r.color}),t.jsxs("td",{align:"right",children:["S/"," ",o(r.price)]}),t.jsx("td",{align:"center",children:a}),t.jsxs("td",{align:"right",children:["S/"," ",o(m)]})]},s)})})]})})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Resumen"})}),t.jsxs("div",{className:"card-body p-2",children:[t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Subtotal:"}),t.jsxs("span",{children:["S/ ",o(e==null?void 0:e.amount)]})]}),t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Envío:"}),t.jsxs("span",{children:["S/"," ",o(e==null?void 0:e.delivery)]})]}),(e==null?void 0:e.coupon)&&t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsxs("b",{children:["Cupón aplicado:",t.jsxs("small",{className:"d-block text-muted",style:{fontWeight:"lighter"},children:[(N=e==null?void 0:e.coupon)==null?void 0:N.name," (-",((y=e==null?void 0:e.coupon)==null?void 0:y.amount)*100/100,"%)"]})]}),t.jsxs("span",{children:["S/ -",o(e==null?void 0:e.coupon_discount)]})]}),t.jsx("hr",{className:"my-2"}),t.jsxs("div",{className:"d-flex justify-content-between",children:[t.jsx("b",{children:"Total:"}),t.jsx("span",{children:t.jsxs("strong",{children:["S/ ",o(E)]})})]})]})]})]}),t.jsxs("div",{className:"col-md-4",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Estado"})}),t.jsx("div",{className:"card-body p-2",children:t.jsxs("div",{className:"",children:[t.jsx("label",{htmlFor:"statusSelect",className:"form-label",children:"Estado Actual"}),t.jsx("select",{className:"form-select",id:"statusSelect",value:e==null?void 0:e.status_id,onChange:_,disabled:!((v=e==null?void 0:e.status)!=null&&v.reversible),children:c.map((r,s)=>t.jsx("option",{value:r.id,children:r.name},s))})]})})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header p-2",children:t.jsx("h5",{className:"card-title mb-0",children:"Cambios de Estado"})}),t.jsx("div",{className:"card-body p-2 d-flex flex-column gap-1",style:{maxHeight:"300px",overflowY:"auto"},children:p==null?void 0:p.map((r,s)=>{var a,m,h;return t.jsxs("article",{class:"border py-1 px-2 ms-3",style:{position:"relative",borderRadius:"16px 4px 4px 16px",backgroundColor:r.status.color?`${r.status.color}2e`:"#3333332e"},children:[t.jsx("i",{className:"mdi mdi-circle left-2",style:{color:r.status.color||"#333",position:"absolute",left:"-25px",top:"50%",transform:"translateY(-50%)"}}),t.jsx("b",{style:{color:r.status.color||"#333"},children:(a=r==null?void 0:r.status)==null?void 0:a.name}),t.jsxs("small",{className:"d-block text-truncate",children:[(m=r==null?void 0:r.user)==null?void 0:m.name," ",(h=r==null?void 0:r.user)==null?void 0:h.lastname]}),t.jsx("small",{className:"d-block text-muted",children:moment(r.created_at).format("YYYY-MM-DD HH:mm")})]},s)})})]})]})]})})]})};O((c,n)=>{A(c).render(t.jsx(P,{...n,title:"Pedidos",children:t.jsx(W,{...n})}))});
