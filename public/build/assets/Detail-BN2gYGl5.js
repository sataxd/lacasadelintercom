var V=Object.defineProperty;var N=(c,r,n)=>r in c?V(c,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[r]=n;var I=(c,r,n)=>(N(c,typeof r!="symbol"?r+"":r,n),n);import{j as C}from"./AboutHeader-CpM0iYLI.js";import{r as a}from"./index-B80Lgev0.js";import{m as b}from"./main-Br9xqDfn.js";import{B as A}from"./Results-B-D6O2Fz.js";import{M as L,u as P,P as T,a as O,b as $,L as B,m as F}from"./proxy-BI9mV89-.js";import{c as D}from"./createLucideIcon-Cx5eUsrb.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class J extends A{constructor(){super(...arguments);I(this,"path","items");I(this,"verifyStock",async n=>{try{const{status:s,result:l}=await b.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(n)});if(!s)throw new Error((l==null?void 0:l.message)??"OcurriÃ³ un error al consultar el stock de los productos");return l.data??[]}catch{return[]}});I(this,"getDestacados",async()=>{try{const{status:n,result:s}=await b.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!n)throw new Error((s==null?void 0:s.message)??"OcurriÃ³ un error al consultar el stock de los productos");return s.data??[]}catch{return[]}})}}class _ extends a.Component{getSnapshotBeforeUpdate(r){const n=this.props.childRef.current;if(n&&r.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function G({children:c,isPresent:r}){const n=a.useId(),s=a.useRef(null),l=a.useRef({width:0,height:0,top:0,left:0}),{nonce:q}=a.useContext(L);return a.useInsertionEffect(()=>{const{width:g,height:f,top:v,left:p}=l.current;if(r||!s.current||!g||!f)return;s.current.dataset.motionPopId=n;const m=document.createElement("style");return q&&(m.nonce=q),document.head.appendChild(m),m.sheet&&m.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${f}px !important;
            top: ${v}px !important;
            left: ${p}px !important;
          }
        `),()=>{document.head.removeChild(m)}},[r]),C.jsx(_,{isPresent:r,childRef:s,sizeRef:l,children:a.cloneElement(c,{ref:s})})}const K=({children:c,initial:r,isPresent:n,onExitComplete:s,custom:l,presenceAffectsLayout:q,mode:g})=>{const f=P(U),v=a.useId(),p=a.useCallback(E=>{f.set(E,!0);for(const t of f.values())if(!t)return;s&&s()},[f,s]),m=a.useMemo(()=>({id:v,initial:r,isPresent:n,custom:l,onExitComplete:p,register:E=>(f.set(E,!1),()=>f.delete(E))}),q?[Math.random(),p]:[n,p]);return a.useMemo(()=>{f.forEach((E,t)=>f.set(t,!1))},[n]),a.useEffect(()=>{!n&&!f.size&&s&&s()},[n]),g==="popLayout"&&(c=C.jsx(G,{isPresent:n,children:c})),C.jsx(T.Provider,{value:m,children:c})};function U(){return new Map}const R=c=>c.key||"";function k(c){const r=[];return a.Children.forEach(c,n=>{a.isValidElement(n)&&r.push(n)}),r}const X=({children:c,custom:r,initial:n=!0,onExitComplete:s,presenceAffectsLayout:l=!0,mode:q="sync",propagate:g=!1})=>{const[f,v]=O(g),p=a.useMemo(()=>k(c),[c]),m=g&&!f?[]:p.map(R),E=a.useRef(!0),t=a.useRef(p),i=P(()=>new Map),[y,e]=a.useState(p),[o,d]=a.useState(p);$(()=>{E.current=!1,t.current=p;for(let w=0;w<o.length;w++){const u=R(o[w]);m.includes(u)?i.delete(u):i.get(u)!==!0&&i.set(u,!1)}},[o,m.length,m.join("-")]);const x=[];if(p!==y){let w=[...p];for(let u=0;u<o.length;u++){const z=o[u],S=R(z);m.includes(S)||(w.splice(u,0,z),x.push(z))}q==="wait"&&x.length&&(w=x),d(k(w)),e(p);return}const{forceRender:h}=a.useContext(B);return C.jsx(C.Fragment,{children:o.map(w=>{const u=R(w),z=g&&!f?!1:p===o||m.includes(u),S=()=>{if(i.has(u))i.set(u,!0);else return;let j=!0;i.forEach(M=>{M||(j=!1)}),j&&(h==null||h(),d(t.current),g&&(v==null||v()),s&&s())};return C.jsx(K,{isPresent:z,initial:!E.current||n?void 0:!1,custom:z?void 0:r,presenceAffectsLayout:l,mode:q,onExitComplete:z?void 0:S,children:w},u)})})};/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=D("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),W=({message:c,actionLabel:r,onAction:n,duration:s=5e3,onClose:l})=>{const[q,g]=a.useState(!0);a.useEffect(()=>{const v=setTimeout(()=>g(!1),s);return()=>clearTimeout(v)},[s]);const f=()=>{g(!1),l&&l()};return C.jsx(X,{children:q&&C.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:"fixed bottom-10 left-10 bg-[#5339B1] text-white px-6 py-5 rounded-xl shadow-xl flex items-center space-x-4 z-[9999]",children:[C.jsx("span",{className:"flex-grow",children:c}),r&&C.jsx("a",{href:"/checkout",className:"bg-[#FF9900] text-white p-3 rounded-xl shadow",children:r}),C.jsx("button",{onClick:f,className:"bg-red-600 p-3 text-white ml-2 rounded-xl",children:C.jsx(H,{size:20})})]})})},Q=a.createContext(),Y=new J,ae=({children:c})=>{const[r,n]=a.useState(()=>{const t=localStorage.getItem("carrito");return t?JSON.parse(t):[]}),[s,l]=a.useState(null);a.useRef(null);const q=async()=>{try{if(r.length===0)return;Y.verifyStock(r.map(t=>t.id)).then(t=>{const i=r.map(y=>{const e=t.find(o=>o.id===y.id);return e?{...y,price:e.price,final_price:e.final_price,discount:e.discount,name:e.name}:y});n(i)})}catch(t){console.error("Error al actualizar precios:",t)}};a.useEffect(()=>{q()},[]),a.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(r))},[r]),a.useEffect(()=>{if(r.length>0){const t=setTimeout(()=>{l({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3});const i=setInterval(()=>{l({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3})},3e4);return()=>clearInterval(i)},6e4);return()=>clearTimeout(t)}else l(null)},[r]);const g=t=>{n(i=>{var d;if(!(t.sizes&&t.sizes.length>0||t.colors&&t.colors.length>0))return i.find(h=>h.id===t.id)?i.map(h=>h.id===t.id?{...h,quantity:h.quantity+t.quantity}:h):[...i,{...t,variations:[],quantity:t.quantity}];const e={color:t.selectedColor||null,size:t.selectedSize||null,quantity:t.quantity},o=i.findIndex(x=>x.id===t.id);if(o>=0){const x=[...i],h=x[o],w=((d=h.variations)==null?void 0:d.findIndex(u=>u.color===e.color&&u.size===e.size))??-1;return w>=0?x[o]={...h,variations:h.variations.map((u,z)=>z===w?{...u,quantity:u.quantity+e.quantity}:u)}:x[o]={...h,variations:[...h.variations,e]},x}else return[...i,{...t,variations:[e],quantity:t.quantity}]}),l({message:"Se ha agregado el artÃ­culo al carrito",actionLabel:"Ver carrito",duration:5e3})},f=t=>{n(i=>i.filter(y=>y.id!==t)),l(null)},v=()=>{n([]),l(null)},p=(t,i=null)=>{n(y=>y.map(e=>e.id===t&&(!e.variations||e.variations.length===0)?{...e,quantity:e.quantity+1}:e.id===t&&e.variations&&e.variations.length>0?i?{...e,variations:e.variations.map(o=>o.color===i.color&&o.size===i.size?{...o,quantity:o.quantity+1}:o)}:{...e,variations:e.variations.map((o,d)=>d===0?{...o,quantity:o.quantity+1}:o)}:e))},m=(t,i=null)=>{n(y=>y.map(e=>{if(e.id===t&&(!e.variations||e.variations.length===0))return{...e,quantity:Math.max(1,e.quantity-1)};if(e.id===t&&e.variations&&e.variations.length>0){if(!i){const d=e.variations.map((x,h)=>h===0?{...x,quantity:Math.max(1,x.quantity-1)}:x);return{...e,variations:d}}const o=e.variations.map(d=>d.color===i.color&&d.size===i.size?{...d,quantity:Math.max(1,d.quantity-1)}:d);return{...e,variations:o}}return e}))},E=(t,i=null)=>{n(y=>i?y.map(e=>{if(e.id===t&&e.variations){const o=e.variations.filter(d=>!(d.color===i.color&&d.size===i.size&&d.quantity===0));return o.length===0?null:{...e,variations:o}}return e}).filter(Boolean):y.filter(e=>!(e.id===t&&e.quantity===0)))};return C.jsxs(Q.Provider,{value:{carrito:r,agregarAlCarrito:g,eliminarProducto:f,vaciarCarrito:v,actualizarPrecios:q,decrementarCantidad:m,incrementarCantidad:p,eliminarSiCero:E},children:[c,s&&C.jsx(W,{...s,onClose:()=>l(null)})]})};export{ae as C,Q as a};
