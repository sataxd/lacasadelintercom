var V=Object.defineProperty;var T=(a,r,n)=>r in a?V(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n;var S=(a,r,n)=>(T(a,typeof r!="symbol"?r+"":r,n),n);import{j as q}from"./AboutHeader-CpM0iYLI.js";import{r as i}from"./index-B80Lgev0.js";import{m as P}from"./main-Br9xqDfn.js";import{B as N}from"./Results-B-D6O2Fz.js";import{M as L,u as I,P as O,a as $,b as A,L as B,m as F}from"./proxy-BI9mV89-.js";import{c as D}from"./createLucideIcon-Cx5eUsrb.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class J extends N{constructor(){super(...arguments);S(this,"path","items");S(this,"verifyStock",async n=>{try{const{status:s,result:u}=await P.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(n)});if(!s)throw new Error((u==null?void 0:u.message)??"OcurriÃ³ un error al consultar el stock de los productos");return u.data??[]}catch{return[]}});S(this,"getDestacados",async()=>{try{const{status:n,result:s}=await P.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!n)throw new Error((s==null?void 0:s.message)??"OcurriÃ³ un error al consultar el stock de los productos");return s.data??[]}catch{return[]}})}}class _ extends i.Component{getSnapshotBeforeUpdate(r){const n=this.props.childRef.current;if(n&&r.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function G({children:a,isPresent:r}){const n=i.useId(),s=i.useRef(null),u=i.useRef({width:0,height:0,top:0,left:0}),{nonce:g}=i.useContext(L);return i.useInsertionEffect(()=>{const{width:m,height:f,top:E,left:h}=u.current;if(r||!s.current||!m||!f)return;s.current.dataset.motionPopId=n;const y=document.createElement("style");return g&&(y.nonce=g),document.head.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${m}px !important;
            height: ${f}px !important;
            top: ${E}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(y)}},[r]),q.jsx(_,{isPresent:r,childRef:s,sizeRef:u,children:i.cloneElement(a,{ref:s})})}const K=({children:a,initial:r,isPresent:n,onExitComplete:s,custom:u,presenceAffectsLayout:g,mode:m})=>{const f=I(U),E=i.useId(),h=i.useCallback(z=>{f.set(z,!0);for(const v of f.values())if(!v)return;s&&s()},[f,s]),y=i.useMemo(()=>({id:E,initial:r,isPresent:n,custom:u,onExitComplete:h,register:z=>(f.set(z,!1),()=>f.delete(z))}),g?[Math.random(),h]:[n,h]);return i.useMemo(()=>{f.forEach((z,v)=>f.set(v,!1))},[n]),i.useEffect(()=>{!n&&!f.size&&s&&s()},[n]),m==="popLayout"&&(a=q.jsx(G,{isPresent:n,children:a})),q.jsx(O.Provider,{value:y,children:a})};function U(){return new Map}const j=a=>a.key||"";function b(a){const r=[];return i.Children.forEach(a,n=>{i.isValidElement(n)&&r.push(n)}),r}const X=({children:a,custom:r,initial:n=!0,onExitComplete:s,presenceAffectsLayout:u=!0,mode:g="sync",propagate:m=!1})=>{const[f,E]=$(m),h=i.useMemo(()=>b(a),[a]),y=m&&!f?[]:h.map(j),z=i.useRef(!0),v=i.useRef(h),t=I(()=>new Map),[c,x]=i.useState(h),[e,l]=i.useState(h);A(()=>{z.current=!1,v.current=h;for(let o=0;o<e.length;o++){const p=j(e[o]);y.includes(p)?t.delete(p):t.get(p)!==!0&&t.set(p,!1)}},[e,y.length,y.join("-")]);const d=[];if(h!==c){let o=[...h];for(let p=0;p<e.length;p++){const w=e[p],R=j(w);y.includes(R)||(o.splice(p,0,w),d.push(w))}g==="wait"&&d.length&&(o=d),l(b(o)),x(h);return}const{forceRender:C}=i.useContext(B);return q.jsx(q.Fragment,{children:e.map(o=>{const p=j(o),w=m&&!f?!1:h===e||y.includes(p),R=()=>{if(t.has(p))t.set(p,!0);else return;let k=!0;t.forEach(M=>{M||(k=!1)}),k&&(C==null||C(),l(v.current),m&&(E==null||E()),s&&s())};return q.jsx(K,{isPresent:w,initial:!z.current||n?void 0:!1,custom:w?void 0:r,presenceAffectsLayout:u,mode:g,onExitComplete:w?void 0:R,children:o},p)})})};/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=D("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),W=({message:a,actionLabel:r,onAction:n,duration:s=5e3,onClose:u})=>{const[g,m]=i.useState(!0);i.useEffect(()=>{const E=setTimeout(()=>m(!1),s);return()=>clearTimeout(E)},[s]);const f=()=>{m(!1),u&&u()};return q.jsx(X,{children:g&&q.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:"fixed bottom-10 left-10 bg-[#5339B1] text-white px-6 py-5 rounded-xl shadow-xl flex items-center space-x-4 z-[9999]",children:[q.jsx("span",{className:"flex-grow",children:a}),r&&q.jsx("a",{href:"/checkout",className:"bg-[#FF9900] text-white p-3 rounded-xl shadow",children:r}),q.jsx("button",{onClick:f,className:"bg-red-600 p-3 text-white ml-2 rounded-xl",children:q.jsx(H,{size:20})})]})})},Q=i.createContext(),Y=new J,ae=({children:a})=>{const[r,n]=i.useState(()=>{const t=localStorage.getItem("carrito");return t?JSON.parse(t):[]}),[s,u]=i.useState(null),g=i.useRef(null),m=async()=>{try{if(r.length===0)return;Y.verifyStock(r.map(t=>t.id)).then(t=>{const c=r.map(x=>{const e=t.find(l=>l.id===x.id);return e?{...x,price:e.price,final_price:e.final_price,discount:e.discount,name:e.name}:x});n(c)})}catch(t){console.error("Error al actualizar precios:",t)}};i.useEffect(()=>{m()},[]),i.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(r))},[r]),i.useEffect(()=>(r.length>0?(g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{u({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",duration:5e3})},1e3)):u(null),()=>clearTimeout(g.current)),[r]);const f=t=>{n(c=>{var d;if(!(t.sizes&&t.sizes.length>0||t.colors&&t.colors.length>0))return c.find(o=>o.id===t.id)?c.map(o=>o.id===t.id?{...o,quantity:o.quantity+t.quantity}:o):[...c,{...t,variations:[],quantity:t.quantity}];const e={color:t.selectedColor||null,size:t.selectedSize||null,quantity:t.quantity},l=c.findIndex(C=>C.id===t.id);if(l>=0){const C=[...c],o=C[l],p=((d=o.variations)==null?void 0:d.findIndex(w=>w.color===e.color&&w.size===e.size))??-1;return p>=0?C[l]={...o,variations:o.variations.map((w,R)=>R===p?{...w,quantity:w.quantity+e.quantity}:w)}:C[l]={...o,variations:[...o.variations,e]},C}else return[...c,{...t,variations:[e],quantity:t.quantity}]}),u({message:"Se ha agregado el artÃ­culo al carrito",actionLabel:"Ver carrito",duration:5e3})},E=t=>{n(c=>c.filter(x=>x.id!==t)),u(null)},h=()=>{n([]),u(null)},y=(t,c=null)=>{n(x=>x.map(e=>e.id===t&&(!e.variations||e.variations.length===0)?{...e,quantity:e.quantity+1}:e.id===t&&e.variations&&e.variations.length>0?c?{...e,variations:e.variations.map(l=>l.color===c.color&&l.size===c.size?{...l,quantity:l.quantity+1}:l)}:{...e,variations:e.variations.map((l,d)=>d===0?{...l,quantity:l.quantity+1}:l)}:e))},z=(t,c=null)=>{n(x=>x.map(e=>{if(e.id===t&&(!e.variations||e.variations.length===0))return{...e,quantity:Math.max(1,e.quantity-1)};if(e.id===t&&e.variations&&e.variations.length>0){if(!c){const d=e.variations.map((C,o)=>o===0?{...C,quantity:Math.max(1,C.quantity-1)}:C);return{...e,variations:d}}const l=e.variations.map(d=>d.color===c.color&&d.size===c.size?{...d,quantity:Math.max(1,d.quantity-1)}:d);return{...e,variations:l}}return e}))},v=(t,c=null)=>{n(x=>c?x.map(e=>{if(e.id===t&&e.variations){const l=e.variations.filter(d=>!(d.color===c.color&&d.size===c.size&&d.quantity===0));return l.length===0?null:{...e,variations:l}}return e}).filter(Boolean):x.filter(e=>!(e.id===t&&e.quantity===0)))};return q.jsxs(Q.Provider,{value:{carrito:r,agregarAlCarrito:f,eliminarProducto:E,vaciarCarrito:h,actualizarPrecios:m,decrementarCantidad:z,incrementarCantidad:y,eliminarSiCero:v},children:[a,s&&q.jsx(W,{...s,onClose:()=>u(null)})]})};export{ae as C,Q as a};
