var N=Object.defineProperty;var $=(l,s,n)=>s in l?N(l,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[s]=n;var I=(l,s,n)=>($(l,typeof s!="symbol"?s+"":s,n),n);import{j as y}from"./AboutHeader-CpM0iYLI.js";import{r as a}from"./index-B80Lgev0.js";import{m as j}from"./main-Br9xqDfn.js";import{B as A}from"./Results-B-D6O2Fz.js";import{M as L,u as V,P as T,a as F,b as O,L as B,m as _}from"./proxy-BI9mV89-.js";import{c as D}from"./createLucideIcon-Cx5eUsrb.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class J extends A{constructor(){super(...arguments);I(this,"path","items");I(this,"verifyStock",async n=>{try{const{status:r,result:c}=await j.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(n)});if(!r)throw new Error((c==null?void 0:c.message)??"OcurriÃ³ un error al consultar el stock de los productos");return c.data??[]}catch{return[]}});I(this,"getDestacados",async()=>{try{const{status:n,result:r}=await j.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!n)throw new Error((r==null?void 0:r.message)??"OcurriÃ³ un error al consultar el stock de los productos");return r.data??[]}catch{return[]}})}}class G extends a.Component{getSnapshotBeforeUpdate(s){const n=this.props.childRef.current;if(n&&s.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function K({children:l,isPresent:s}){const n=a.useId(),r=a.useRef(null),c=a.useRef({width:0,height:0,top:0,left:0}),{nonce:v}=a.useContext(L);return a.useInsertionEffect(()=>{const{width:g,height:f,top:q,left:h}=c.current;if(s||!r.current||!g||!f)return;r.current.dataset.motionPopId=n;const p=document.createElement("style");return v&&(p.nonce=v),document.head.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${f}px !important;
            top: ${q}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(p)}},[s]),y.jsx(G,{isPresent:s,childRef:r,sizeRef:c,children:a.cloneElement(l,{ref:r})})}const U=({children:l,initial:s,isPresent:n,onExitComplete:r,custom:c,presenceAffectsLayout:v,mode:g})=>{const f=V(X),q=a.useId(),h=a.useCallback(z=>{f.set(z,!0);for(const e of f.values())if(!e)return;r&&r()},[f,r]),p=a.useMemo(()=>({id:q,initial:s,isPresent:n,custom:c,onExitComplete:h,register:z=>(f.set(z,!1),()=>f.delete(z))}),v?[Math.random(),h]:[n,h]);return a.useMemo(()=>{f.forEach((z,e)=>f.set(e,!1))},[n]),a.useEffect(()=>{!n&&!f.size&&r&&r()},[n]),g==="popLayout"&&(l=y.jsx(K,{isPresent:n,children:l})),y.jsx(T.Provider,{value:p,children:l})};function X(){return new Map}const R=l=>l.key||"";function P(l){const s=[];return a.Children.forEach(l,n=>{a.isValidElement(n)&&s.push(n)}),s}const H=({children:l,custom:s,initial:n=!0,onExitComplete:r,presenceAffectsLayout:c=!0,mode:v="sync",propagate:g=!1})=>{const[f,q]=F(g),h=a.useMemo(()=>P(l),[l]),p=g&&!f?[]:h.map(R),z=a.useRef(!0),e=a.useRef(h),o=V(()=>new Map),[x,t]=a.useState(h),[i,m]=a.useState(h);O(()=>{z.current=!1,e.current=h;for(let w=0;w<i.length;w++){const u=R(i[w]);p.includes(u)?o.delete(u):o.get(u)!==!0&&o.set(u,!1)}},[i,p.length,p.join("-")]);const C=[];if(h!==x){let w=[...h];for(let u=0;u<i.length;u++){const d=i[u],k=R(d);p.includes(k)||(w.splice(u,0,d),C.push(d))}v==="wait"&&C.length&&(w=C),m(P(w)),t(h);return}const{forceRender:E}=a.useContext(B);return y.jsx(y.Fragment,{children:i.map(w=>{const u=R(w),d=g&&!f?!1:h===i||p.includes(u),k=()=>{if(o.has(u))o.set(u,!0);else return;let b=!0;o.forEach(S=>{S||(b=!1)}),b&&(E==null||E(),m(e.current),g&&(q==null||q()),r&&r())};return y.jsx(U,{isPresent:d,initial:!z.current||n?void 0:!1,custom:d?void 0:s,presenceAffectsLayout:c,mode:v,onExitComplete:d?void 0:k,children:w},u)})})};/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=D("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Q=({message:l,actionLabel:s,onAction:n,duration:r=5e3,onClose:c})=>{const[v,g]=a.useState(!0);a.useEffect(()=>{const q=setTimeout(()=>g(!1),r);return()=>clearTimeout(q)},[r]);const f=()=>{g(!1),c&&c()};return y.jsx(H,{children:v&&y.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:`fixed md:bottom-10 md:left-10 bottom-4 left-4 right-4 
                bg-[#5339B1] text-white px-4 py-3 md:px-6 md:py-5 rounded-lg 
                md:rounded-xl shadow-xl flex items-center justify-between 
                space-x-2 md:space-x-4 z-[9999] max-w-[90vw] lg:w-max mx-auto`,children:[y.jsx("span",{className:"flex-grow text-sm md:text-base max-w-[200px] md:max-w-none truncate",children:l}),y.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4 flex-shrink-0",children:[s&&y.jsx("a",{href:"/checkout",className:`bg-[#FF9900] text-white px-3 py-2 
                            md:px-4 md:py-3 text-sm md:text-base rounded-lg
                            md:rounded-xl shadow hover:bg-[#FFAA33] 
                            transition-colors whitespace-nowrap`,children:s}),y.jsx("button",{onClick:f,className:`bg-red-600 hover:bg-red-700 p-2 
                        md:p-3 text-white rounded-lg md:rounded-xl 
                        transition-colors`,children:y.jsx(W,{size:18,className:"md:w-5 md:h-5 w-4 h-4"})})]})]})})},Y=a.createContext(),M=new J,oe=({children:l})=>{const[s,n]=a.useState(()=>{const e=localStorage.getItem("carrito");return e?JSON.parse(e):[]}),[r,c]=a.useState(null);a.useRef(null);const v=async()=>{try{if(s.length===0)return;M.verifyStock(s.map(e=>e.id)).then(e=>{const o=s.map(x=>{const t=e.find(i=>i.id===x.id);return t?{...x,price:t.price,final_price:t.final_price,discount:t.discount,name:t.name}:x});n(o)})}catch(e){console.error("Error al actualizar precios:",e)}};a.useEffect(()=>{v()},[]),a.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(s))},[s]),a.useEffect(()=>{if(s.length>0){const e=setTimeout(()=>{c({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3});const o=setInterval(()=>{c({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3})},3e4);return()=>clearInterval(o)},6e4);return()=>clearTimeout(e)}else c(null)},[s]);const g=async e=>{const o=[];e.sizes&&e.sizes.length>0||e.colors&&e.colors.length>0?o.push({id:e.id,quantity:e.quantity,color:e.selectedColor||null,size:e.selectedSize||null}):o.push({id:e.id,quantity:e.quantity,color:null,size:null});const t=(await M.verifyStock(o))[0];if(!t||!t.available){c({message:`No hay stock suficiente para "${e.name}"${t&&t.color?` (${t.color}${t.size?" - "+t.size:""})`:""}.`,actionLabel:"Ver productos",duration:5e3});return}n(i=>{var w;if(!(e.sizes&&e.sizes.length>0||e.colors&&e.colors.length>0))return i.find(d=>d.id===e.id)?i.map(d=>d.id===e.id?{...d,quantity:d.quantity+e.quantity}:d):[...i,{...e,variations:[],quantity:e.quantity}];const C={color:e.selectedColor||null,size:e.selectedSize||null,quantity:e.quantity},E=i.findIndex(u=>u.id===e.id);if(E>=0){const u=[...i],d=u[E],k=((w=d.variations)==null?void 0:w.findIndex(b=>b.color===C.color&&b.size===C.size))??-1;return k>=0?u[E]={...d,variations:d.variations.map((b,S)=>S===k?{...b,quantity:b.quantity+C.quantity}:b)}:u[E]={...d,variations:[...d.variations,C]},u}else return[...i,{...e,variations:[C],quantity:e.quantity}]}),c({message:"Se ha agregado el artÃ­culo al carrito",actionLabel:"Ver carrito",duration:5e3})},f=e=>{n(o=>o.filter(x=>x.id!==e)),c(null),localStorage.removeItem(`ad_shown_${e}`)},q=()=>{n([]),c(null)},h=(e,o=null)=>{n(x=>x.map(t=>t.id===e&&(!t.variations||t.variations.length===0)?{...t,quantity:t.quantity+1}:t.id===e&&t.variations&&t.variations.length>0?o?{...t,variations:t.variations.map(i=>i.color===o.color&&i.size===o.size?{...i,quantity:i.quantity+1}:i)}:{...t,variations:t.variations.map((i,m)=>m===0?{...i,quantity:i.quantity+1}:i)}:t))},p=(e,o=null)=>{n(x=>x.map(t=>{if(t.id===e&&(!t.variations||t.variations.length===0))return{...t,quantity:Math.max(1,t.quantity-1)};if(t.id===e&&t.variations&&t.variations.length>0){if(!o){const m=t.variations.map((C,E)=>E===0?{...C,quantity:Math.max(1,C.quantity-1)}:C);return{...t,variations:m}}const i=t.variations.map(m=>m.color===o.color&&m.size===o.size?{...m,quantity:Math.max(1,m.quantity-1)}:m);return{...t,variations:i}}return t}))},z=(e,o=null)=>{n(x=>o?x.map(t=>{if(t.id===e&&t.variations){const i=t.variations.filter(m=>!(m.color===o.color&&m.size===o.size&&m.quantity===0));return i.length===0?null:{...t,variations:i}}return t}).filter(Boolean):x.filter(t=>!(t.id===e&&t.quantity===0)))};return y.jsxs(Y.Provider,{value:{carrito:s,agregarAlCarrito:g,eliminarProducto:f,vaciarCarrito:q,actualizarPrecios:v,decrementarCantidad:p,incrementarCantidad:h,eliminarSiCero:z},children:[l,r&&y.jsx(Q,{...r,onClose:()=>c(null)})]})};export{oe as C,Y as a};
