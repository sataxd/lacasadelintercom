var F=Object.defineProperty;var O=(l,r,n)=>r in l?F(l,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[r]=n;var P=(l,r,n)=>(O(l,typeof r!="symbol"?r+"":r,n),n);import{j as p}from"./AboutHeader-CpM0iYLI.js";import{r as o}from"./index-B80Lgev0.js";import{m as N}from"./main-Br9xqDfn.js";import{B}from"./Results-B-D6O2Fz.js";import{M as D,u as L,P as _,a as G,b as J,L as U,m as K}from"./proxy-BI9mV89-.js";import{c as X}from"./createLucideIcon-Cx5eUsrb.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class H extends B{constructor(){super(...arguments);P(this,"path","items");P(this,"verifyStock",async n=>{try{const{status:i,result:c}=await N.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(n)});if(!i)throw new Error((c==null?void 0:c.message)??"OcurriÃ³ un error al consultar el stock de los productos");return c.data??[]}catch{return[]}});P(this,"getDestacados",async()=>{try{const{status:n,result:i}=await N.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!n)throw new Error((i==null?void 0:i.message)??"OcurriÃ³ un error al consultar el stock de los productos");return i.data??[]}catch{return[]}})}}class W extends o.Component{getSnapshotBeforeUpdate(r){const n=this.props.childRef.current;if(n&&r.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=n.offsetHeight||0,i.width=n.offsetWidth||0,i.top=n.offsetTop,i.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Q({children:l,isPresent:r}){const n=o.useId(),i=o.useRef(null),c=o.useRef({width:0,height:0,top:0,left:0}),{nonce:C}=o.useContext(D);return o.useInsertionEffect(()=>{const{width:g,height:d,top:v,left:h}=c.current;if(r||!i.current||!g||!d)return;i.current.dataset.motionPopId=n;const y=document.createElement("style");return C&&(y.nonce=C),document.head.appendChild(y),y.sheet&&y.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${g}px !important;
            height: ${d}px !important;
            top: ${v}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(y)}},[r]),p.jsx(W,{isPresent:r,childRef:i,sizeRef:c,children:o.cloneElement(l,{ref:i})})}const Y=({children:l,initial:r,isPresent:n,onExitComplete:i,custom:c,presenceAffectsLayout:C,mode:g})=>{const d=L(Z),v=o.useId(),h=o.useCallback(E=>{d.set(E,!0);for(const e of d.values())if(!e)return;i&&i()},[d,i]),y=o.useMemo(()=>({id:v,initial:r,isPresent:n,custom:c,onExitComplete:h,register:E=>(d.set(E,!1),()=>d.delete(E))}),C?[Math.random(),h]:[n,h]);return o.useMemo(()=>{d.forEach((E,e)=>d.set(e,!1))},[n]),o.useEffect(()=>{!n&&!d.size&&i&&i()},[n]),g==="popLayout"&&(l=p.jsx(Q,{isPresent:n,children:l})),p.jsx(_.Provider,{value:y,children:l})};function Z(){return new Map}const M=l=>l.key||"";function $(l){const r=[];return o.Children.forEach(l,n=>{o.isValidElement(n)&&r.push(n)}),r}const ee=({children:l,custom:r,initial:n=!0,onExitComplete:i,presenceAffectsLayout:c=!0,mode:C="sync",propagate:g=!1})=>{const[d,v]=G(g),h=o.useMemo(()=>$(l),[l]),y=g&&!d?[]:h.map(M),E=o.useRef(!0),e=o.useRef(h),s=L(()=>new Map),[f,t]=o.useState(h),[a,u]=o.useState(h);J(()=>{E.current=!1,e.current=h;for(let z=0;z<a.length;z++){const m=M(a[z]);y.includes(m)?s.delete(m):s.get(m)!==!0&&s.set(m,!1)}},[a,y.length,y.join("-")]);const x=[];if(h!==f){let z=[...h];for(let m=0;m<a.length;m++){const b=a[m],S=M(b);y.includes(S)||(z.splice(m,0,b),x.push(b))}C==="wait"&&x.length&&(z=x),u($(z)),t(h);return}const{forceRender:w}=o.useContext(U);return p.jsx(p.Fragment,{children:a.map(z=>{const m=M(z),b=g&&!d?!1:h===a||y.includes(m),S=()=>{if(s.has(m))s.set(m,!0);else return;let k=!0;s.forEach(j=>{j||(k=!1)}),k&&(w==null||w(),u(e.current),g&&(v==null||v()),i&&i())};return p.jsx(Y,{isPresent:b,initial:!E.current||n?void 0:!1,custom:b?void 0:r,presenceAffectsLayout:c,mode:C,onExitComplete:b?void 0:S,children:z},m)})})};/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=X("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ne=({message:l,actionLabel:r,onAction:n,duration:i=5e3,onClose:c})=>{const[C,g]=o.useState(!0);o.useEffect(()=>{const v=setTimeout(()=>g(!1),i);return()=>clearTimeout(v)},[i]);const d=()=>{g(!1),c&&c()};return p.jsx(ee,{children:C&&p.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:`fixed md:bottom-10 md:left-10 bottom-4 left-4 right-4 
                bg-[#5339B1] text-white px-4 py-3 md:px-6 md:py-5 rounded-lg 
                md:rounded-xl shadow-xl flex items-center justify-between 
                space-x-2 md:space-x-4 z-[9999] max-w-[90vw] lg:w-max mx-auto`,children:[p.jsx("span",{className:"flex-grow text-sm md:text-base max-w-[200px] md:max-w-none truncate",children:l}),p.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4 flex-shrink-0",children:[r&&p.jsx("a",{href:"/checkout",className:`bg-[#FF9900] text-white px-3 py-2 
                            md:px-4 md:py-3 text-sm md:text-base rounded-lg
                            md:rounded-xl shadow hover:bg-[#FFAA33] 
                            transition-colors whitespace-nowrap`,children:r}),p.jsx("button",{onClick:d,className:`bg-red-600 hover:bg-red-700 p-2 
                        md:p-3 text-white rounded-lg md:rounded-xl 
                        transition-colors`,children:p.jsx(te,{size:18,className:"md:w-5 md:h-5 w-4 h-4"})})]})]})})},se=o.createContext(),A=new H,fe=({children:l})=>{const[r,n]=o.useState(()=>{const e=localStorage.getItem("carrito");return e?JSON.parse(e):[]}),[i,c]=o.useState(null);o.useRef(null);const C=async()=>{try{if(r.length===0)return;const e=r.flatMap(s=>s.variations&&s.variations.length>0?s.variations.map(f=>({id:s.id,quantity:f.quantity,color:f.color||null,size:f.size||null})):[{id:s.id,quantity:s.quantity,color:null,size:null}]);A.verifyStock(e).then(s=>{const f=r.map(t=>{const a=s.find(u=>u.id===t.id);return a?{...t,price:a.price,final_price:a.final_price,discount:a.discount,name:a.name}:t});n(f)})}catch(e){console.error("Error al actualizar precios:",e)}};o.useEffect(()=>{C()},[]),o.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(r))},[r]),o.useEffect(()=>{if(r.length>0){const e=setTimeout(()=>{c({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3});const s=setInterval(()=>{c({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3})},3e4);return()=>clearInterval(s)},6e4);return()=>clearTimeout(e)}else c(null)},[r]);const g=async e=>{const s=[],f=e.colors&&e.colors.length>0||e.selectedColor,t=e.sizes&&e.sizes.length>0||e.selectedSize;f||t?s.push({id:e.id,quantity:e.quantity,color:e.selectedColor||null,size:e.selectedSize||null}):s.push({id:e.id,quantity:e.quantity,color:null,size:null});const x=(await A.verifyStock(s))[0];return!x||!x.available?(c({id:Date.now(),message:`No hay stock suficiente para "${e.name}"${x&&x.color?` (${x.color}${x.size?" - "+x.size:""})`:""}.`,actionLabel:"Ver productos",duration:5e3}),{success:!1,message:`No hay stock suficiente para "${e.name}"`}):(n(w=>{var j;const z=e.colors&&e.colors.length>0||e.selectedColor,m=e.sizes&&e.sizes.length>0||e.selectedSize;if(!(z||m))return w.find(q=>q.id===e.id)?w.map(q=>q.id===e.id?{...q,quantity:q.quantity+e.quantity}:q):[...w,{...e,variations:[],quantity:e.quantity}];const S={color:e.selectedColor||null,size:e.selectedSize||null,quantity:e.quantity},k=w.findIndex(I=>I.id===e.id);if(k>=0){const I=[...w],q=I[k],V=((j=q.variations)==null?void 0:j.findIndex(R=>R.color===S.color&&R.size===S.size))??-1;return V>=0?I[k]={...q,variations:q.variations.map((R,T)=>T===V?{...R,quantity:R.quantity+S.quantity}:R)}:I[k]={...q,variations:[...q.variations,S]},I}else return[...w,{...e,variations:[S],quantity:e.quantity}]}),console.log("ðŸ›’ DEBUG - Product added to cart successfully"),c({id:Date.now(),message:"Se ha agregado el artÃ­culo al carrito",actionLabel:"Ver carrito",duration:5e3}),{success:!0})},d=e=>{n(s=>s.filter(f=>f.id!==e)),c(null),localStorage.removeItem(`ad_shown_${e}`)},v=()=>{n([]),c(null)},h=(e,s=null)=>{n(f=>f.map(t=>t.id===e&&(!t.variations||t.variations.length===0)?{...t,quantity:t.quantity+1}:t.id===e&&t.variations&&t.variations.length>0?s?{...t,variations:t.variations.map(a=>a.color===s.color&&a.size===s.size?{...a,quantity:a.quantity+1}:a)}:{...t,variations:t.variations.map((a,u)=>u===0?{...a,quantity:a.quantity+1}:a)}:t))},y=(e,s=null)=>{n(f=>f.map(t=>{if(t.id===e&&(!t.variations||t.variations.length===0))return{...t,quantity:Math.max(1,t.quantity-1)};if(t.id===e&&t.variations&&t.variations.length>0){if(!s){const u=t.variations.map((x,w)=>w===0?{...x,quantity:Math.max(1,x.quantity-1)}:x);return{...t,variations:u}}const a=t.variations.map(u=>u.color===s.color&&u.size===s.size?{...u,quantity:Math.max(1,u.quantity-1)}:u);return{...t,variations:a}}return t}))},E=(e,s=null)=>{n(f=>s?f.map(t=>{if(t.id===e&&t.variations){const a=t.variations.filter(u=>!(u.color===s.color&&u.size===s.size&&u.quantity===0));return a.length===0?null:{...t,variations:a}}return t}).filter(Boolean):f.filter(t=>!(t.id===e&&t.quantity===0)))};return p.jsxs(se.Provider,{value:{carrito:r,agregarAlCarrito:g,eliminarProducto:d,vaciarCarrito:v,actualizarPrecios:C,decrementarCantidad:y,incrementarCantidad:h,eliminarSiCero:E},children:[l,i&&p.jsx(ne,{...i,onClose:()=>c(null)})]})};export{fe as C,se as a};
