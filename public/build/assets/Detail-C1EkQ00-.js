var L=Object.defineProperty;var F=(c,i,n)=>i in c?L(c,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[i]=n;var j=(c,i,n)=>(F(c,typeof i!="symbol"?i+"":i,n),n);import{j as C}from"./AboutHeader-CpM0iYLI.js";import{r as l}from"./index-B80Lgev0.js";import{m as N}from"./main-Br9xqDfn.js";import{B as O}from"./Results-B-D6O2Fz.js";import{M as B,u as T,P as D,a as G,b as J,L as U,m as K}from"./proxy-BI9mV89-.js";import{c as X}from"./createLucideIcon-Cx5eUsrb.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class H extends O{constructor(){super(...arguments);j(this,"path","items");j(this,"verifyStock",async n=>{try{const{status:r,result:u}=await N.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(n)});if(!r)throw new Error((u==null?void 0:u.message)??"OcurriÃ³ un error al consultar el stock de los productos");return u.data??[]}catch{return[]}});j(this,"getDestacados",async()=>{try{const{status:n,result:r}=await N.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!n)throw new Error((r==null?void 0:r.message)??"OcurriÃ³ un error al consultar el stock de los productos");return r.data??[]}catch{return[]}})}}class W extends l.Component{getSnapshotBeforeUpdate(i){const n=this.props.childRef.current;if(n&&i.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Q({children:c,isPresent:i}){const n=l.useId(),r=l.useRef(null),u=l.useRef({width:0,height:0,top:0,left:0}),{nonce:z}=l.useContext(B);return l.useInsertionEffect(()=>{const{width:w,height:h,top:v,left:p}=u.current;if(i||!r.current||!w||!h)return;r.current.dataset.motionPopId=n;const g=document.createElement("style");return z&&(g.nonce=z),document.head.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${w}px !important;
            height: ${h}px !important;
            top: ${v}px !important;
            left: ${p}px !important;
          }
        `),()=>{document.head.removeChild(g)}},[i]),C.jsx(W,{isPresent:i,childRef:r,sizeRef:u,children:l.cloneElement(c,{ref:r})})}const Y=({children:c,initial:i,isPresent:n,onExitComplete:r,custom:u,presenceAffectsLayout:z,mode:w})=>{const h=T(Z),v=l.useId(),p=l.useCallback(E=>{h.set(E,!0);for(const e of h.values())if(!e)return;r&&r()},[h,r]),g=l.useMemo(()=>({id:v,initial:i,isPresent:n,custom:u,onExitComplete:p,register:E=>(h.set(E,!1),()=>h.delete(E))}),z?[Math.random(),p]:[n,p]);return l.useMemo(()=>{h.forEach((E,e)=>h.set(e,!1))},[n]),l.useEffect(()=>{!n&&!h.size&&r&&r()},[n]),w==="popLayout"&&(c=C.jsx(Q,{isPresent:n,children:c})),C.jsx(D.Provider,{value:g,children:c})};function Z(){return new Map}const V=c=>c.key||"";function $(c){const i=[];return l.Children.forEach(c,n=>{l.isValidElement(n)&&i.push(n)}),i}const ee=({children:c,custom:i,initial:n=!0,onExitComplete:r,presenceAffectsLayout:u=!0,mode:z="sync",propagate:w=!1})=>{const[h,v]=G(w),p=l.useMemo(()=>$(c),[c]),g=w&&!h?[]:p.map(V),E=l.useRef(!0),e=l.useRef(p),s=T(()=>new Map),[m,t]=l.useState(p),[a,o]=l.useState(p);J(()=>{E.current=!1,e.current=p;for(let y=0;y<a.length;y++){const x=V(a[y]);g.includes(x)?s.delete(x):s.get(x)!==!0&&s.set(x,!1)}},[a,g.length,g.join("-")]);const d=[];if(p!==m){let y=[...p];for(let x=0;x<a.length;x++){const S=a[x],k=V(S);g.includes(k)||(y.splice(x,0,S),d.push(S))}z==="wait"&&d.length&&(y=d),o($(y)),t(p);return}const{forceRender:f}=l.useContext(U);return C.jsx(C.Fragment,{children:a.map(y=>{const x=V(y),S=w&&!h?!1:p===a||g.includes(x),k=()=>{if(s.has(x))s.set(x,!0);else return;let b=!0;s.forEach(R=>{R||(b=!1)}),b&&(f==null||f(),o(e.current),w&&(v==null||v()),r&&r())};return C.jsx(Y,{isPresent:S,initial:!E.current||n?void 0:!1,custom:S?void 0:i,presenceAffectsLayout:u,mode:z,onExitComplete:S?void 0:k,children:y},x)})})};/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=X("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ne=({message:c,actionLabel:i,onAction:n,duration:r=5e3,onClose:u})=>{const[z,w]=l.useState(!0);l.useEffect(()=>{const v=setTimeout(()=>w(!1),r);return()=>clearTimeout(v)},[r]);const h=()=>{w(!1),u&&u()};return C.jsx(ee,{children:z&&C.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:`fixed md:bottom-10 md:left-10 bottom-4 left-4 right-4 
                bg-[#5339B1] text-white px-4 py-3 md:px-6 md:py-5 rounded-lg 
                md:rounded-xl shadow-xl flex items-center justify-between 
                space-x-2 md:space-x-4 z-[9999] max-w-[90vw] lg:w-max mx-auto`,children:[C.jsx("span",{className:"flex-grow text-sm md:text-base max-w-[200px] md:max-w-none truncate",children:c}),C.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4 flex-shrink-0",children:[i&&C.jsx("a",{href:"/checkout",className:`bg-[#FF9900] text-white px-3 py-2 
                            md:px-4 md:py-3 text-sm md:text-base rounded-lg
                            md:rounded-xl shadow hover:bg-[#FFAA33] 
                            transition-colors whitespace-nowrap`,children:i}),C.jsx("button",{onClick:h,className:`bg-red-600 hover:bg-red-700 p-2 
                        md:p-3 text-white rounded-lg md:rounded-xl 
                        transition-colors`,children:C.jsx(te,{size:18,className:"md:w-5 md:h-5 w-4 h-4"})})]})]})})},se=l.createContext(),A=new H,fe=({children:c})=>{const[i,n]=l.useState(()=>{const e=localStorage.getItem("carrito");return e?JSON.parse(e):[]}),[r,u]=l.useState(null);l.useRef(null);const z=async()=>{try{if(i.length===0)return;const e=i.flatMap(s=>s.variations&&s.variations.length>0?s.variations.map(m=>({id:s.id,quantity:m.quantity,color:m.color||null,size:m.size||null})):[{id:s.id,quantity:s.quantity,color:null,size:null}]);A.verifyStock(e).then(s=>{const m=i.map(t=>{if(t.variations&&t.variations.length>0){const a=t.variations.map(d=>{const f=s.find(y=>y.id===t.id&&y.color===d.color&&y.size===d.size);return f?{...d,price:f.price,final_price:f.final_price,discount:f.discount}:d}),o=s.find(d=>d.id===t.id);return{...t,variations:a,price:o?o.price:t.price,final_price:o?o.final_price:t.final_price,discount:o?o.discount:t.discount,name:o?o.name:t.name}}else{const a=s.find(o=>o.id===t.id&&!o.color&&!o.size);return a?{...t,price:a.price,final_price:a.final_price,discount:a.discount,name:a.name}:t}});n(m)})}catch(e){console.error("Error al actualizar precios:",e)}};l.useEffect(()=>{z()},[]),l.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(i))},[i]),l.useEffect(()=>{if(i.length>0){const e=setTimeout(()=>{u({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3});const s=setInterval(()=>{u({message:"Â¡No olvides completar tu compra! ðŸ˜‰",actionLabel:"Ver carrito",onAction:()=>console.log("Ir al carrito"),duration:5e3})},3e4);return()=>clearInterval(s)},6e4);return()=>clearTimeout(e)}else u(null)},[i]);const w=async e=>{const s=[],m=e.colors&&e.colors.length>0||e.selectedColor,t=e.sizes&&e.sizes.length>0||e.selectedSize;m||t?s.push({id:e.id,quantity:e.quantity,color:e.selectedColor||null,size:e.selectedSize||null}):s.push({id:e.id,quantity:e.quantity,color:null,size:null});const d=(await A.verifyStock(s))[0];if(!d||!d.available)return u({id:Date.now(),message:`No hay stock suficiente para "${e.name}"${d&&d.color?` (${d.color}${d.size?" - "+d.size:""})`:""}.`,actionLabel:"Ver productos",duration:5e3}),{success:!1,message:`No hay stock suficiente para "${e.name}"`};if(n(f=>{var R;const y=e.colors&&e.colors.length>0||e.selectedColor,x=e.sizes&&e.sizes.length>0||e.selectedSize;if(!(y||x))return f.find(q=>q.id===e.id)?f.map(q=>q.id===e.id?{...q,quantity:q.quantity+e.quantity}:q):[...f,{...e,variations:[],quantity:e.quantity}];const k={color:e.selectedColor||null,size:e.selectedSize||null,quantity:e.quantity},b=f.findIndex(I=>I.id===e.id);if(b>=0){const I=[...f],q=I[b],M=((R=q.variations)==null?void 0:R.findIndex(P=>P.color===k.color&&P.size===k.size))??-1;return M>=0?I[b]={...q,variations:q.variations.map((P,_)=>_===M?{...P,quantity:P.quantity+k.quantity}:P)}:I[b]={...q,variations:[...q.variations,k]},I}else return[...f,{...e,variations:[k],quantity:e.quantity}]}),console.log("ðŸ›’ DEBUG - Product added to cart successfully"),typeof window<"u"&&window.TrackingPixels){const f=d.price||0,y=e.alias||e.name||"Producto",x=e.id;window.TrackingPixels.trackAddToCart(f,"PEN",y,x)}return u({id:Date.now(),message:"Se ha agregado el artÃ­culo al carrito",actionLabel:"Ver carrito",duration:5e3}),{success:!0}},h=e=>{n(s=>s.filter(m=>m.id!==e)),u(null),localStorage.removeItem(`ad_shown_${e}`)},v=()=>{n([]),u(null)},p=(e,s=null)=>{n(m=>m.map(t=>t.id===e&&(!t.variations||t.variations.length===0)?{...t,quantity:t.quantity+1}:t.id===e&&t.variations&&t.variations.length>0?s?{...t,variations:t.variations.map(a=>a.color===s.color&&a.size===s.size?{...a,quantity:a.quantity+1}:a)}:{...t,variations:t.variations.map((a,o)=>o===0?{...a,quantity:a.quantity+1}:a)}:t))},g=(e,s=null)=>{n(m=>m.map(t=>{if(t.id===e&&(!t.variations||t.variations.length===0))return{...t,quantity:Math.max(1,t.quantity-1)};if(t.id===e&&t.variations&&t.variations.length>0){if(!s){const o=t.variations.map((d,f)=>f===0?{...d,quantity:Math.max(1,d.quantity-1)}:d);return{...t,variations:o}}const a=t.variations.map(o=>o.color===s.color&&o.size===s.size?{...o,quantity:Math.max(1,o.quantity-1)}:o);return{...t,variations:a}}return t}))},E=(e,s=null)=>{n(m=>s?m.map(t=>{if(t.id===e&&t.variations){const a=t.variations.filter(o=>!(o.color===s.color&&o.size===s.size&&o.quantity===0));return a.length===0?null:{...t,variations:a}}return t}).filter(Boolean):m.filter(t=>!(t.id===e&&t.quantity===0)))};return C.jsxs(se.Provider,{value:{carrito:i,agregarAlCarrito:w,eliminarProducto:h,vaciarCarrito:v,actualizarPrecios:z,decrementarCantidad:g,incrementarCantidad:p,eliminarSiCero:E},children:[c,r&&C.jsx(ne,{...r,onClose:()=>u(null)})]})};export{ne as A,fe as C,se as a};
