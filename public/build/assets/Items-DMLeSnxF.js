import{j as r}from"./AboutHeader-CpM0iYLI.js";import{B as ie}from"./Base-CFRwUR9o.js";import{S as N}from"./SwitchFormGroup-Cv62QkRk.js";import{r as s}from"./index-B80Lgev0.js";import{c as ae}from"./ReactAppend-CBRQCQGz.js";import{r as B}from"./DxBox-CdMuSyGE.js";import{S as oe}from"./sweetalert2.all-Dh0rZL5X.js";import{I as ce}from"./ItemsRest-DaHsoVkP.js";import{M as ue}from"./Modal-Dbgjpj-3.js";import"./main-Br9xqDfn.js";import{I as me}from"./ImageFormGroup-CUCbODBj.js";import{I as j}from"./InputFormGroup-CFHZRLOG.js";import{S as U}from"./SelectFormGroup-iHLz_kPb.js";import{D as V}from"./DxButton-CsjWvhyj.js";import{C as de}from"./CreateReactScript-CyT_ENnh.js";import{N as H}from"./Number2Currency-e57Tgsuk.js";import{R as y}from"./ReactAppend-C-tNgxIf.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./index.esm-Cu-mVv1q.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./WhatsAppModal-CqDsSnoc.js";import"./Results-B-D6O2Fz.js";/* empty css               */const pe=({gridRef:i,rest:f,columns:m,toolBar:w,masterDetail:c,filterValue:h,onRefresh:g=()=>{}})=>(s.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(i.current).dxDataGrid({language:"es",dataSource:{load:async u=>{const d=await f.paginate({...u});return g(d),d}},onToolbarPreparing:u=>{const{items:d}=u.toolbarOptions;w(d)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:h,rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:10},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:m,masterDetail:c,onContentReady:(...u)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),r.jsx("div",{ref:i})),fe=({title:i,gridRef:f,rest:m,columns:w,toolBar:c,masterDetail:h,filterValue:g=[],onRefresh:u})=>r.jsx("div",{className:"row",children:r.jsx("div",{className:"col-12",children:r.jsxs("div",{className:"card",children:[typeof i=="object"?r.jsx("div",{className:"card-header",children:i}):"",r.jsxs("div",{className:"card-body",children:[typeof i!="object"?r.jsxs("h4",{className:"header-title",children:[r.jsx("div",{id:"header-title-options",className:"float-end"}),r.jsx("span",{id:"header-title-prefix"})," Lista de ",i," ",r.jsx("span",{id:"header-title-suffix"})]}):"",r.jsx(pe,{gridRef:f,rest:m,columns:w.filter(Boolean),toolBar:c,masterDetail:h,filterValue:g,onRefresh:u})]})]})})}),C=new ce,he=({categories:i,brands:f})=>{const[m,w]=s.useState([]),c=s.useRef(),h=s.useRef(),g=s.useRef(),u=s.useRef(),d=s.useRef(),I=s.useRef(),R=s.useRef(),x=s.useRef(),D=s.useRef(),T=s.useRef(),E=s.useRef(),P=s.useRef(),_=s.useRef(),G=s.useRef(),[J,A]=s.useState(!1),[ge,W]=s.useState(null),[xe,K]=s.useState(null),[k,p]=s.useState([]),M=s.useRef(),Q=e=>{const l=Array.from(e.target.files).map(n=>({file:n,url:URL.createObjectURL(n)}));p(n=>[...n,...l])},X=e=>{e.preventDefault();const l=Array.from(e.dataTransfer.files).map(n=>({file:n,url:URL.createObjectURL(n)}));p(n=>[...n,...l])},Y=e=>{e.preventDefault()},Z=(e,t)=>{e.preventDefault(),k[t].id?p(n=>n.map((a,v)=>v===t?{...a,toDelete:!0}:a)):p(n=>n.filter((a,v)=>v!==t))};s.useEffect(()=>{if(m&&m.images){const e=m.images.map(t=>({id:t.id,url:`/api/items/media/${t.url}`}));p(e)}},[m]);const[b,S]=s.useState(null),O=e=>{if(w(e||null),e!=null&&e.id?A(!0):A(!1),g.current.value=(e==null?void 0:e.id)||"",$(u.current).val((e==null?void 0:e.category_id)||null).trigger("change"),d.current.value=(e==null?void 0:e.name)||"",I.current.value=(e==null?void 0:e.summary)||"",R.current.value=(e==null?void 0:e.price)||0,x.current.value=(e==null?void 0:e.discount)||0,$(P.current).val((e==null?void 0:e.score)||null).trigger("change"),D.current.value=null,D.image.src=`/api/items/media/${(e==null?void 0:e.image)??"undefined"}`,T.current.value=null,e!=null&&e.manual?S(`/storage/images/item/${e.manual}`):S(null),E.current.value=(e==null?void 0:e.description)??"",e!=null&&e.images){const t=e.images.map(l=>({id:l.id,url:`/api/items/media/${l.url}`}));p(t)}else p([]);_.current.value=e==null?void 0:e.stock,G.current.value=e==null?void 0:e.min_stock,$(h.current).modal("show")},ee=async e=>{e.preventDefault();let t=0,l=0;x.current.value&&x.current.value>0?(t=x.current.value,l=100-x.current.value*100/R.current.value):(t=R.current.value,l=0);const n={id:g.current.value||void 0,category_id:u.current.value,name:d.current.value,summary:I.current.value,price:R.current.value,discount:x.current.value,description:E.current.value,stock:_.current.value,min_stock:G.current.value,score:P.current.value,final_price:t,discount_percent:l},a=new FormData;for(const o in n)a.append(o,n[o]);const v=D.current.files[0];v&&a.append("image",v);const z=T.current.files[0];z&&b&&a.append("manual",z),k.forEach((o,L)=>{o.toDelete||(o.file?a.append(`gallery[${L}]`,o.file):a.append(`gallery_ids[${L}]`,o.id))});const q=k.filter(o=>o.toDelete).map(o=>parseInt(o.id,10));q.length>0&&a.append("deleted_images",JSON.stringify(q)),await C.save(a)&&($(c.current).dxDataGrid("instance").refresh(),$(h.current).modal("hide"),p([]))},re=async({id:e,value:t})=>{await C.boolean({id:e,field:"visible",value:t})&&$(c.current).dxDataGrid("instance").refresh()},F=async({id:e,field:t,value:l})=>{await C.boolean({id:e,field:t,value:l})&&$(c.current).dxDataGrid("instance").refresh()},te=async e=>{const{isConfirmed:t}=await oe.fire({title:"Eliminar Item",text:"¿Estás seguro de eliminar este item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await C.delete(e)||$(c.current).dxDataGrid("instance").refresh()},le=[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}],se=e=>{const t=e.target.files[0];t&&S(URL.createObjectURL(t))},ne=()=>{S(null)};return r.jsxs(r.Fragment,{children:[r.jsx(fe,{gridRef:c,title:"Items",rest:C,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(c.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar",onClick:()=>O()}})},exportable:!0,exportableName:"Items",columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"category.name",caption:"Categoría",width:"120px",cellTemplate:(e,{data:t})=>{var l,n;e.html(B(r.jsxs(r.Fragment,{children:[r.jsx("b",{className:"d-block",children:(l=t.category)==null?void 0:l.name}),r.jsx("small",{className:"text-muted",children:(n=t.subcategory)==null?void 0:n.name})]})))}},{dataField:"category.name",caption:"Categoria",visible:!1},{dataField:"name",caption:"Nombre",width:"300px",cellTemplate:(e,{data:t})=>{e.html(B(r.jsxs(r.Fragment,{children:[r.jsx("b",{children:t.name}),r.jsx("br",{}),r.jsx("span",{className:"truncate",children:t.summary})]})))}},{dataField:"final_price",caption:"Precio",dataType:"number",width:"75px",cellTemplate:(e,{data:t})=>{e.html(B(r.jsxs(r.Fragment,{children:[t.discount>0&&r.jsxs("small",{className:"d-block text-muted",style:{textDecoration:"line-through"},children:["S/.",H(t.price)]}),r.jsxs("span",{children:["S/.",H(t.discount>0?t.discount:t.price)]})]})))}},{dataField:"image",caption:"Imagen",width:"90px",allowFiltering:!1,cellTemplate:(e,{data:t})=>{y(e,r.jsx("img",{src:`/api/items/media/${t.image}`,style:{width:"80px",height:"48px",objectFit:"cover",objectPosition:"center",borderRadius:"4px"},onError:l=>l.target.src="/api/cover/thumbnail/null"}))}},{dataField:"is_new",caption:"Nuevo",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{y(e,r.jsx(N,{checked:t.is_new,onChange:l=>F({id:t.id,field:"is_new",value:l.target.checked})}))}},{dataField:"offering",caption:"En oferta",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{y(e,r.jsx(N,{checked:t.offering,onChange:l=>F({id:t.id,field:"offering",value:l.target.checked})}))}},{dataField:"recommended",caption:"Recomendado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{y(e,r.jsx(N,{checked:t.recommended,onChange:l=>F({id:t.id,field:"recommended",value:l.target.checked})}))}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{y(e,r.jsx(N,{checked:t.featured,onChange:l=>F({id:t.id,field:"featured",value:l.target.checked})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"80px",cellTemplate:(e,{data:t})=>{y(e,r.jsx(N,{checked:t.visible,onChange:l=>re({id:t.id,value:l.target.checked})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.css("text-overflow","unset"),e.append(V({className:"btn btn-xs btn-soft-primary",title:"Editar",icon:"fa fa-pen",onClick:()=>O(t)})),e.append(V({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>te(t.id)}))},allowFiltering:!1,allowExporting:!1}]}),r.jsxs(ue,{modalRef:h,title:J?"Editar Item":"Agregar Item",onSubmit:ee,size:"xl",children:[r.jsxs("div",{className:"row",id:"principal-container",children:[r.jsx("input",{ref:g,type:"hidden"}),r.jsxs("div",{className:"col-md-6",children:[r.jsx(j,{eRef:d,label:"Nombre",required:!0}),r.jsx(j,{eRef:I,label:"Resumen"}),r.jsx(U,{eRef:u,label:"Categoría",required:!0,dropdownParent:"#principal-container",onChange:e=>W(e.target.value),children:i.map((e,t)=>r.jsx("option",{value:e.id,children:e.name},t))}),r.jsx(j,{label:"Stock mínimo",eRef:G,type:"number"}),r.jsx(j,{label:"Stock",eRef:_,type:"number"}),r.jsx(j,{eRef:R,label:"Precio",type:"number",step:"0.01",required:!0}),r.jsx(j,{eRef:x,label:"Descuento",type:"number",step:"0.01"}),r.jsx(U,{eRef:P,label:"Calificación",required:!0,dropdownParent:"#principal-container",onChange:e=>K(e.target.value),children:le.map((e,t)=>r.jsx("option",{value:e.value,children:e.label},t))})]}),r.jsx("div",{className:"col-md-6",children:r.jsxs("div",{className:"row",children:[r.jsx(me,{eRef:D,label:"Imagen",aspect:1,col:"col-lg-6 col-md-12 col-sm-6"}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-sm-6",children:[r.jsx("label",{className:"form-label",children:"Galeria"}),r.jsx("input",{id:"input-item-gallery",ref:M,type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:Q}),r.jsx("div",{style:{border:"2px dashed #ccc",padding:"20px",textAlign:"center",cursor:"pointer",borderRadius:"4px",boxShadow:"2.5px 2.5px 5px rgba(0,0,0,.125)",aspectRatio:"21/9",height:"254px",width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>M.current.click(),onDrop:X,onDragOver:Y,children:r.jsx("span",{className:"form-label d-block mb-1",children:"Arrastra y suelta imágenes aquí o haz clic para agregar"})})]}),r.jsx("div",{className:"col-md-12 col-sm-12",children:r.jsx("div",{className:"d-flex flex-wrap gap-1  mt-2",children:k.map((e,t)=>r.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[r.jsx("img",{src:`${e.url}`,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px"}}),r.jsx("button",{className:"btn btn-xs btn-danger position-absolute",style:{top:0,right:0},onClick:l=>Z(l,t),children:"×"})]},t))})}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Manual PDF"}),r.jsxs("div",{className:"input-group mb-2",children:[r.jsx("input",{type:"file",className:"form-control",ref:T,accept:".pdf",onChange:se}),b&&r.jsx("div",{className:"input-group-append",children:r.jsx("button",{type:"button",className:"btn btn-danger",onClick:ne,children:r.jsx("i",{className:"fa fa-trash"})})})]}),b&&r.jsxs("div",{className:"mt-2",children:[r.jsx("div",{className:"d-flex align-items-center mb-2",children:r.jsxs("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-soft-primary mr-2",children:[r.jsx("i",{className:"fa fa-file-pdf mr-1"}),"Ver PDF"]})}),r.jsx("div",{className:"border rounded",children:r.jsx("iframe",{src:`${b}#toolbar=0`,type:"application/pdf",width:"100%",height:"400px",children:r.jsxs("p",{children:["Tu navegador no puede mostrar el PDF directamente.",r.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",children:"Haz clic aquí para descargarlo"})]})})})]})]})]})})]}),r.jsx("hr",{className:"my-1"}),r.jsx("label",{className:"form-label",children:"Descripción"}),r.jsx("textarea",{ref:E,className:"form-control",placeholder:"Descripción"})]})]})};de((i,f)=>{ae(i).render(r.jsx(ie,{...f,title:"Items",children:r.jsx(he,{...f})}))});
